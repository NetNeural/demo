name: NetNeural Documentation Maintenance
on:
  push:
    branches: [ main ]
    paths: 
      - 'docs/**'
      - '*/README.md'
      - '*/package.json'
      - '*/go.mod'
  pull_request:
    branches: [ main ]
    paths:
      - 'docs/**'
  schedule:
    # Run daily at 6 AM UTC
    - cron: '0 6 * * *'
  workflow_dispatch:

env:
  OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

jobs:
  documentation-monitoring:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Full history for trend analysis
        
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Update project base path in config
      run: |
        sed -i 's|/path/to/netneural/softwaremono|${{ github.workspace }}|g' ai_blueprint_config.yaml
        
    - name: Run documentation state monitor
      run: |
        python scripts/doc_state_monitor.py
        
    - name: Generate market intelligence update
      if: github.event_name == 'schedule'
      run: |
        python scripts/market_intelligence_updater.py
        
    - name: Analyze historical trends
      if: github.event_name == 'schedule'
      run: |
        python scripts/historical_analyzer.py --period 30
        
    - name: Generate documentation updates
      if: steps.monitor.outputs.significant_changes == 'true'
      run: |
        python scripts/ai_content_generator.py --auto-update
        
    - name: Commit updated documentation
      if: steps.monitor.outputs.changes_detected == 'true'
      run: |
        git config --local user.email "ai-bot@netneural.com"
        git config --local user.name "NetNeural AI Documentation Bot"
        git add docs/
        git commit -m "docs: AI-automated documentation updates

        - Updated documentation based on project state changes
        - Refreshed market intelligence and competitive analysis
        - Generated historical trend analysis
        - Maintained documentation accuracy at 95%+ target
        
        Generated by: NetNeural AI Documentation Blueprint v1.0"
        
    - name: Create Pull Request
      if: github.event_name != 'push'
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: "docs: AI-automated documentation updates"
        title: "ü§ñ AI Documentation Updates"
        body: |
          ## AI Documentation Maintenance Update
          
          This PR contains automated documentation updates generated by the NetNeural AI Documentation Blueprint.
          
          ### Changes Included:
          - üìä Technical documentation synchronization
          - üìà Business intelligence updates  
          - üìã Project status and progress tracking
          - üîç Historical trend analysis
          - üéØ Competitive positioning updates
          
          ### Quality Assurance:
          - ‚úÖ Documentation accuracy validated (95%+ target)
          - ‚úÖ Cross-reference validation completed
          - ‚úÖ Data freshness verified
          - ‚úÖ Stakeholder relevance assessed
          
          **Generated by:** NetNeural AI Documentation Blueprint v1.0
          **Timestamp:** ${{ github.run_id }}
        branch: ai-doc-updates-${{ github.run_number }}
        
    - name: Push to main branch
      if: github.event_name == 'push'
      run: |
        git push origin main
        
    - name: Notify stakeholders
      if: always()
      run: |
        python scripts/stakeholder_notification.py \
          --event "${{ github.event_name }}" \
          --status "${{ job.status }}" \
          --run-id "${{ github.run_id }}"

  weekly-comprehensive-analysis:
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule' && github.event.schedule == '0 6 * * 0'  # Sundays
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Run comprehensive weekly analysis
      run: |
        python scripts/weekly_comprehensive_analysis.py
        
    - name: Generate executive summary
      run: |
        python scripts/executive_summary_generator.py --period weekly
        
    - name: Update interactive dashboards
      run: |
        python scripts/dashboard_updater.py --refresh-all
        
    - name: Commit comprehensive updates
      run: |
        git config --local user.email "ai-bot@netneural.com"  
        git config --local user.name "NetNeural AI Documentation Bot"
        git add docs/
        git commit -m "docs: Weekly comprehensive AI documentation analysis

        - Complete market intelligence refresh
        - Updated competitive analysis and positioning
        - Refreshed financial projections and business metrics
        - Generated executive summary and trend analysis
        - Updated interactive business intelligence dashboards
        
        Generated by: NetNeural AI Documentation Blueprint v1.0 (Weekly Analysis)"
        git push origin main

  monthly-strategic-review:
    runs-on: ubuntu-latest
    if: github.event_name == 'schedule' && github.event.schedule == '0 8 1 * *'  # 1st of month
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Run monthly strategic review
      run: |
        python scripts/monthly_strategic_review.py
        
    - name: Generate investor briefing
      run: |
        python scripts/investor_briefing_generator.py
        
    - name: Update research opportunities
      run: |
        python scripts/research_opportunities_updater.py
        
    - name: Validate all documentation
      run: |
        python scripts/comprehensive_validation.py
        
    - name: Commit strategic updates
      run: |
        git config --local user.email "ai-bot@netneural.com"
        git config --local user.name "NetNeural AI Documentation Bot"
        git add docs/
        git commit -m "docs: Monthly strategic AI documentation review

        - Comprehensive competitive landscape analysis
        - Updated market positioning and strategic recommendations  
        - Refreshed research opportunities and investment priorities
        - Generated investor briefing materials
        - Validated all documentation for accuracy and relevance
        
        Generated by: NetNeural AI Documentation Blueprint v1.0 (Monthly Review)"
        git push origin main
        
    - name: Create monthly report
      uses: actions/upload-artifact@v3
      with:
        name: monthly-strategic-report-${{ github.run_number }}
        path: |
          docs/generated/analysis/monthly_reports/
          docs/generated/business/investor_briefings/
          docs/generated/dashboards/
